# BiliShelf Extension (WXT)

This extension is now migrated to `WXT` and keeps the existing backend API workflow.

## Runtime behavior

- Floating capture panel on `https://www.bilibili.com/video/*`
- Reads current video metadata and tags from Bilibili API
- Loads folders from backend and supports create/select/save flow
- Popup settings with theme switch and quick open manager button (`http://127.0.0.1:5173`)
- Backend API base: `http://127.0.0.1:4321/api`
- Store-ready icon set included in `public/icons`

## Project structure

- `entrypoints/content.ts`: WXT content-script entrypoint
- `entrypoints/popup.html`: WXT popup page entrypoint
- `entrypoints/popup/main.ts`: popup bootstrap
- `content.js`: actual floating panel script (legacy logic kept)
- `popup.js` / `popup.css`: popup logic and styles
- `wxt.config.ts`: manifest config

## Development

```bash
cd extension
pnpm install
pnpm dev
```

Choose browser target when needed:

```bash
pnpm dev:chrome
pnpm dev:edge
pnpm dev:firefox
```

## Build / Zip

```bash
cd extension
pnpm build
pnpm zip
```

Build output is generated by WXT under `.output/`.

One-shot multi-browser build/package:

```bash
cd extension
pnpm build:all
pnpm zip:all
```

Generated zip files:

- `.output/bilishelf-extension-0.1.0-chrome.zip`
- `.output/bilishelf-extension-0.1.0-edge.zip`
- `.output/bilishelf-extension-0.1.0-firefox.zip`

## Permissions scope (current)

- `storage`: save extension theme preference
- `activeTab`: send theme update to current Bilibili tab
- `host_permissions`:
  - `https://www.bilibili.com/*` (video page content script)
  - `https://api.bilibili.com/*` (video detail/tag API)
  - `http://127.0.0.1:4321/*` and `http://localhost:4321/*` (local backend API)

## Load unpacked extension

1. Start backend on `http://127.0.0.1:4321`
2. Run `pnpm build:chrome` / `pnpm build:edge` / `pnpm build:firefox`
3. Open browser extension management page
4. Enable developer mode
5. Load unpacked from:
   - Chrome: `extension/.output/chrome-mv3`
   - Edge: `extension/.output/edge-mv3`
   - Firefox: `extension/.output/firefox-mv2`

## Root-level shortcuts

From repository root:

```bash
pnpm ext:dev
pnpm ext:build:all
pnpm ext:zip:all
pnpm ext:release:prepare
```

## Release checklist

1. Update extension version in `wxt.config.ts`
2. Run `pnpm --dir extension run zip:all`
3. Upload:
   - Chrome Web Store: `.output/bilishelf-extension-0.1.0-chrome.zip`
   - Edge Add-ons: `.output/bilishelf-extension-0.1.0-edge.zip`
   - Firefox AMO: `.output/bilishelf-extension-0.1.0-firefox.zip`
4. Attach screenshots and privacy description in each store dashboard

Detailed release assets:

- `release/store-listing-template.zh-CN.md`
- `release/store-listing-template.en.md`
- `release/submission.chrome-edge.zh-CN.md`
- `release/submission.chrome-edge.en.md`
- `release/submission.firefox.zh-CN.md`
- `release/submission.firefox.en.md`
- `release/permission-qa-template.md`
- `release/screenshots-checklist.md`
- `release/privacy-policy.zh-CN.md`
- `release/privacy-policy.en.md`
- `release/release-checklist.md`
